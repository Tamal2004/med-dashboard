import React from 'react';

import { TesterApplication } from './TesterApplicationForm';
import { AuthPiece } from 'aws-amplify-react';

import { PublicTesterFormContainer } from 'views/Containers';
import { UnsubscribeUser } from '../Account';
import { history } from 'libs/history';

class TesterForm extends AuthPiece {
    constructor(props) {
        super(props);
        this._validAuthStates = ['signUp'];
        this.gotoSignIn = this.gotoSignIn.bind(this);
        this.gotoSignUp = this.gotoSignUp.bind(this);
    }

    state = {
        renderPage: <TesterApplication noauth />
    };

    unsubscribePage = async () => {
        const isUnsubscribePage = history.location.pathname.split('/');
        return isUnsubscribePage[1].trim() === 'unsubscribe';
    };

    gotoSignIn = () => this.props.onStateChange('signIn', {});

    gotoSignUp = () => this.props.onStateChange('signUp', {});

    componentDidMount() {
        const self = this;
        this.unsubscribePage().then(
            res =>
                res &&
                self.setState({
                    renderPage: <UnsubscribeUser gotoSignIn={this.gotoSignIn} />
                })
        );
    }

    showComponent(theme) {
        return (
            <PublicTesterFormContainer
                gotoSignIn={this.gotoSignIn}
                gotoSignUp={this.gotoSignUp}
            >
                {this.state.renderPage}
            </PublicTesterFormContainer>
        );
    }
}

export { TesterForm as default, TesterForm as OpenTesterForm };
